<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="bower_components/prism/themes/prism.css" />
    <link rel="stylesheet" href="css/style.css" />

    <title><%= title %></title>

    <style>
      .<%= prefix %> {
        margin-top: 40px;
      }

      .<%= prefix %>-pattern,
      .<%= prefix %>-listing {
        display: none;
      }

      .<%= prefix %>-pattern.is-active,
      .<%= prefix %>-listing.is-active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="<%= prefix %>-container">
      <nav class="<%= prefix %>-nav" role="navigation">
        <a class="title" href="#/"><%= title %></a>

        <div class="<%= prefix %>-nav-list">
          <a href="javascript:void(0)" class="<%= prefix %>-nav-list-toggle">Patterns <span class="<%= prefix %>-arrow">&#x25bc;</span></a>

          <ul>
            <% _.forEach(patterns, function(pattern) { %>
              <li><a href="#/<%= pattern.slug %>"><%= pattern.title %></a></li>
            <% }); %>
          </ul>
        </div>
      </nav>

      <div class="<%= prefix %>-overview">
        <% _.forEach(patterns, function(pattern) { %>
          <a href="#/<%= pattern.slug %>" class="list-group-item">
            <h4 class="list-group-item-heading"><%= pattern.title %></h4>
            <p class="list-group-item-text"><%= pattern.note %></p>
          </a>
        <% }); %>
      </div>

      <div class="<%= prefix %>-listing">
        <% _.forEach(patterns, function(pattern) { %>
          <%= pattern.html %>
        <% }); %>
      </div>
    </div>

    <script src="bower_components/jquery/jquery.min.js"></script>
    <script src="bower_components/prism/prism.js"></script>
    <script src="bower_components/pathjs/path.min.js"></script>
    <script>
      (function() {
        var activeClass = 'is-active';
        var patternSelector = '.<%= prefix %>pattern';

        function iterateNodes(els, cb) {
          [].forEach.call(els, cb);
        }

        function removeClassFromAll(patterns) {
          iterateNodes(patterns, function(pattern) {
            pattern.classList.remove(activeClass);
          });
        }

        Path.root('#/');

        Path.map('#/').to(function() {
          removeClassFromAll(document.querySelectorAll(patternSelector));

          document.querySelector('.<%= prefix %>-listing').classList.add(activeClass);
        });

        Path.map('#/:name').to(function() {
          document.querySelector('.<%= prefix %>-listing').classList.remove(activeClass);
          removeClassFromAll(document.querySelectorAll(patternSelector));

          document.getElementById(this.params.name).classList.add(activeClass);
        });

        Path.listen();
      })();
    </script>
  </body>
</html>
